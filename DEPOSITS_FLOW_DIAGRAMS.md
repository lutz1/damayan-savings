# Deposits System - Visual Flow Diagrams

## Complete Deposit Journey (With Fallback)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER DEPOSITS COMPLETE FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              MEMBER DASHBOARD
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Click "Deposit" Button         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  DepositDialog.jsx       â”‚
                         â”‚  - User enters â‚±amount   â”‚
                         â”‚  - Click "Pay Now"       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ POST /api/create-payment-link   â”‚
                    â”‚ (Backend)                       â”‚
                    â”‚ - Validates amount              â”‚
                    â”‚ - Creates PayMongo checkout     â”‚
                    â”‚ - Stores in paymentMetadata     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  sessionStorage:               â”‚
                    â”‚  paymongo_checkout_id          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      Redirect to PayMongo Checkout Page            â”‚
            â”‚    (User completes payment on PayMongo.com)        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Payment Completed âœ…         â”‚
                    â”‚   on PayMongo                  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚             â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  WEBHOOK PATH   â”‚ â”‚ REDIRECT   â”‚ â”‚ FALLBACK     â”‚
        â”‚   (Primary)     â”‚ â”‚   PATH     â”‚ â”‚   PATH       â”‚
        â”‚  âœ… ENHANCED    â”‚ â”‚ (Verify)   â”‚ â”‚  âœ… NEW      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚             â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”‚              â”‚
        â”‚ PayMongo sends: â”‚      â”‚              â”‚
        â”‚ POST webhook    â”‚      â”‚              â”‚
        â”‚ /api/paymongo   â”‚      â”‚              â”‚
        â”‚     -webhook    â”‚      â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚              â”‚
                 â”‚               â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚   POST /api/verify-paymongo-payment       â”‚
        â”‚   (Frontend)                              â”‚
        â”‚   - Get paymentMetadata from Firestore    â”‚
        â”‚   - Check if deposit already created      â”‚
        â”‚                                           â”‚
        â”‚   If success: DONE âœ…                     â”‚
        â”‚   If fails: TRY FALLBACK â†“               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CLIENT-SIDE FALLBACK ğŸ”¥ NEW     â”‚
        â”‚   (If backend unreachable)        â”‚
        â”‚   - Read paymentMetadata          â”‚
        â”‚   - Create deposit directly       â”‚
        â”‚     in Firestore                  â”‚
        â”‚   - Show success message          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  âœ… SUCCESS MESSAGE   â”‚      â”‚  âœ… SUCCESS MESSAGE â”‚
        â”‚   (Webhook created    â”‚      â”‚   (Fallback created â”‚
        â”‚    deposit)           â”‚      â”‚    deposit)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ DEPOSIT IN FIRESTORE âœ…  â”‚
                  â”‚                          â”‚
                  â”‚  {                       â”‚
                  â”‚    status: "Pending",    â”‚
                  â”‚    amount: 600,          â”‚
                  â”‚    userId: "xxx",        â”‚
                  â”‚    createdAt: now        â”‚
                  â”‚  }                       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   ADMIN DEPOSITS PAGE    â”‚
                  â”‚   /admin/deposits        â”‚
                  â”‚                          â”‚
                  â”‚  âœ… Shows deposit        â”‚
                  â”‚  âœ… Status: "Pending"    â”‚
                  â”‚  âœ… Can filter/search    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Admin clicks "Approve"   â”‚
                  â”‚                          â”‚
                  â”‚ Dialog opens             â”‚
                  â”‚ Select "Approve"         â”‚
                  â”‚ Click confirm            â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚             â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ UPDATE DEPOSIT â”‚   â”‚   â”‚ UPDATE USER      â”‚
        â”‚ status: "App"  â”‚   â”‚   â”‚ eWallet: +â‚±600   â”‚
        â”‚ reviewedAt: now    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                â”‚            â”‚   â”‚ USER SEES:   â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¤ eWallet â†‘    â”‚
                       â”‚          â”‚ â‚±1,600 âœ…    â”‚
                       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ âœ… COMPLETE          â”‚
                â”‚ Deposit Approved      â”‚
                â”‚ eWallet Updated       â”‚
                â”‚ Transaction Complete  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Scenario A: Normal Flow (Backend Running)

```
Webhook succeeds âœ…

User Deposits          PayMongo           Backend        Firestore
     â”‚                    â”‚                  â”‚               â”‚
     â”œâ”€ Click Deposit â”€â”€â”€â”€>â”‚                  â”‚               â”‚
     â”‚                     â”œâ”€ Send webhook â”€â”€>â”‚               â”‚
     â”‚                     â”‚                  â”œâ”€ Verify â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                  â”œâ”€ Create â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                  â”‚     (Deposit) â”‚
     â”‚                     â”‚                  â”‚               â”‚
     â”‚ Redirect to success >â”‚                  â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ (no longer       â”‚               â”‚
     â”‚                      â”‚  needed)         â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
  /deposit-success page                        â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
     â”‚                      â”‚                  â”‚  Deposit      â”‚
     â”‚                      â”‚                  â”‚  already      â”‚
     â”‚                      â”‚                  â”‚  created âœ…   â”‚
     â”‚                      â”‚                  â”‚               â”‚
     â””â”€ Show "Success" message âœ…

RESULT: Deposit created, user sees success, admin can approve
```

---

## Scenario B: Backend Offline (Fallback Works)

```
Webhook fails but fallback succeeds âœ…

User Deposits          PayMongo           Backend        Firestore
     â”‚                    â”‚                  â”‚               â”‚
     â”œâ”€ Click Deposit â”€â”€â”€â”€>â”‚                  â”‚               â”‚
     â”‚                     â”œâ”€ Send webhook â”€â”€>â”‚               â”‚
     â”‚                     â”‚                  âœ– OFFLINE       â”‚
     â”‚                     â”‚                  (no response)    â”‚
     â”‚                     â”‚                  â”‚               â”‚
     â”‚ Redirect to success >â”‚                  â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
  /deposit-success page                        â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
     â”œâ”€ Try backend verify  â”‚                  â”‚               â”‚
     â”‚   (fails - timeout)  â”‚                  â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
     â”œâ”€ FALLBACK TRIGGERS   â”‚                  â”‚               â”‚
     â”‚  (Client-side)       â”‚                  â”‚               â”‚
     â”‚  â”œâ”€ Read metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚  â”‚  (already stored)                                   â”‚
     â”‚  â”‚                                                     â”‚
     â”‚  â””â”€ Create deposit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚     (directly)                                   (Successâœ…)
     â”‚                                                        â”‚
     â”‚  Show "Success" message âœ…                             â”‚
     â”‚                                                     Deposit
     â”‚                                                     created!
     â”‚
RESULT: Deposit created by fallback, user sees success, admin can approve
```

---

## Scenario C: Webhook Timing Issue (Both Create)

```
Race condition (handled gracefully)

User Deposits          PayMongo           Backend        Firestore
     â”‚                    â”‚                  â”‚               â”‚
     â”œâ”€ Click Deposit â”€â”€â”€â”€>â”‚                  â”‚               â”‚
     â”‚                     â”œâ”€ Send webhook â”€â”€>â”‚               â”‚
     â”‚                     â”‚                  â”œâ”€ Delayed      â”‚
     â”‚                     â”‚                  â”‚   (slow)      â”‚
     â”‚ Redirect           â”‚                  â”‚               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
  /deposit-success page                        â”‚               â”‚
     â”‚                      â”‚                  â”‚               â”‚
     â”œâ”€ Try backend (slow)  â”‚                  â”‚               â”‚
     â”‚  â”œâ”€ Timeout! â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€ Still â”€â”€â”€â”€â”€â”€>â”‚
     â”‚  â”‚                   â”‚                  â”‚  processing   â”‚
     â”‚  â”œâ”€ FALLBACK         â”‚                  â”‚               â”‚
     â”‚  â”‚  â”œâ”€ Read metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ (almost done) â”‚
     â”‚  â”‚  â”‚  Found! âœ…                        â”‚               â”‚
     â”‚  â”‚  â”‚                â”‚                  â”œâ”€ Create â”€â”€â”€â”€> Deposit A
     â”‚  â”‚  â””â”€ CREATE deposit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> (Fallback)
     â”‚  â”‚                   â”‚                  â”‚               â”‚
     â”‚  â”‚                   â”‚                  â”‚  Webhook â”€â”€â”€â”€> Deposit B
     â”‚  â”‚                   â”‚                  â”‚     done!     (But checks
     â”‚  â”‚                   â”‚                  â”‚               first)
     â”‚  â”‚                   â”‚                  â”‚               
     â”‚  Show Success        â”‚                  â”‚
     â”‚  message âœ…          â”‚                  â”‚

RESULT: Both try to create
  â†’ Webhook sees metadata.depositId exists â†’ skips
  â†’ Fallback succeeds
  â†’ No duplicate! âœ…
```

---

## Admin Approval Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ADMIN DEPOSITS WORKFLOW                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Admin clicks /admin/deposits
     â”‚
     â”œâ”€ TABLE SHOWS:
     â”‚  â”œâ”€ Name: "User Name"
     â”‚  â”œâ”€ Amount: "â‚±600"
     â”‚  â”œâ”€ Status: "Pending" (Yellow)
     â”‚  â”œâ”€ Date: "Jan 13, 2026"
     â”‚  â””â”€ Action: "Approve / Reject" button
     â”‚
     â”œâ”€ Admin clicks "Approve / Reject" button
     â”‚     â”‚
     â”‚     â””â”€ Dialog opens
     â”‚        â”œâ”€ Shows: "User Name deposited â‚±600"
     â”‚        â”œâ”€ Status dropdown: [Pending â–¼] / [Approved] / [Rejected]
     â”‚        â”œâ”€ Remarks field: [Admin notes...]
     â”‚        â””â”€ Buttons: [Cancel] [Confirm]
     â”‚
     â”œâ”€ Admin selects "Approve" and clicks "Confirm"
     â”‚     â”‚
     â”‚     â””â”€ TWO DATABASE UPDATES HAPPEN:
     â”‚        â”‚
     â”‚        â”œâ”€ UPDATE deposits/{depositId}
     â”‚        â”‚  â”œâ”€ status: "Pending" â†’ "Approved"
     â”‚        â”‚  â”œâ”€ reviewedAt: now()
     â”‚        â”‚  â””â”€ remarks: "Notes from admin"
     â”‚        â”‚
     â”‚        â””â”€ UPDATE users/{userId}
     â”‚           â””â”€ eWallet: 1000 â†’ 1600 (added â‚±600)
     â”‚
     â”œâ”€ Dialog closes
     â”‚
     â”œâ”€ TABLE UPDATES
     â”‚  â””â”€ Status: "Approved" (Green) âœ…
     â”‚
     â””â”€ USER SEES IN DASHBOARD
        â””â”€ eWallet: â‚±1,600 âœ…

Success flow complete!
```

---

## Decision Tree: Why Isn't My Deposit Showing?

```
â”Œâ”€ Is the webhook URL configured in PayMongo Dashboard?
â”‚  â”œâ”€ NO  â†’ Go configure it! (See DEPOSITS_ACTION_ITEMS.md)
â”‚  â””â”€ YES â”
â”‚         â””â”€ Can you see "[paymongo-webhook]" in Render logs?
â”‚            â”œâ”€ NO  â†’ Backend not receiving webhook
â”‚            â”‚      â†’ Check PayMongo webhook URL is correct
â”‚            â”‚      â†’ Check webhook is enabled
â”‚            â””â”€ YES â”
â”‚                   â””â”€ Does log say "DEPOSIT CREATED"?
â”‚                      â”œâ”€ NO  â†’ Share the error log
â”‚                      â”‚      â†’ I'll help debug
â”‚                      â””â”€ YES â”
â”‚                             â””â”€ Does /admin/deposits show it?
â”‚                                â”œâ”€ NO  â†’ Firestore issue
â”‚                                â”‚      â†’ Check user role
â”‚                                â””â”€ YES â”
â”‚                                       â””â”€ Click "Approve"
â”‚                                          â”œâ”€ eWallet updated? âœ…
â”‚                                          â””â”€ Status changed? âœ…
â”‚
â””â”€ âœ… COMPLETE - You're done!
```

---

## Key Improvements Made

```
BEFORE vs AFTER

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEFORE                  â”‚ AFTER                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Backend fails        â”‚ âœ… Fallback catches it   â”‚
â”‚   â†’ Deposit lost        â”‚   â†’ Deposit still saved  â”‚
â”‚                         â”‚                          â”‚
â”‚ âŒ No detailed logging  â”‚ âœ… Enhanced logging      â”‚
â”‚   â†’ Hard to debug       â”‚   â†’ Know exactly why     â”‚
â”‚                         â”‚     something failed     â”‚
â”‚                         â”‚                          â”‚
â”‚ âŒ Only webhook method  â”‚ âœ… Two methods (webhook  â”‚
â”‚   â†’ Single point of     â”‚   + fallback)            â”‚
â”‚     failure             â”‚   â†’ Redundancy           â”‚
â”‚                         â”‚                          â”‚
â”‚ âŒ No offline support   â”‚ âœ… Full offline support  â”‚
â”‚   â†’ Backend must be     â”‚   â†’ Works even if        â”‚
â”‚     running             â”‚     backend is down      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This visual guide shows exactly how deposits flow through your system.**

Last Updated: January 13, 2026
